'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.archive = undefined;

var _request = require('request');

var _request2 = _interopRequireDefault(_request);

var _unzipStream = require('unzip-stream');

var _unzipStream2 = _interopRequireDefault(_unzipStream);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var archive = exports.archive = function archive(filename, outputPath) {
  return new Promise(function (resolve, reject) {
    var req = _request2.default.get('https://s3-eu-west-1.amazonaws.com/lokalise-assets/' + filename).on('response', function (response) {
      if (response.statusCode >= 400) {
        req.destroy();
        return reject(Error('Bad Status Code: ' + response.statusCode));
      }
      if (response.headers['content-type'] !== 'application/octet-stream') {
        req.destroy();
        return reject(Error('Bad Content-Type: ' + response.headers['content-type']));
      }
    });
    req.pipe(_unzipStream2.default.Extract({ path: outputPath })).on('error', function (err) {
      return reject(err);
    }).on('close', function () {
      return resolve();
    });
  });
};